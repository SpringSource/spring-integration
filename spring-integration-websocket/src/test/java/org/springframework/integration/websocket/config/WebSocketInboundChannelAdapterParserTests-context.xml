<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:int="http://www.springframework.org/schema/integration"
	   xmlns:websocket="http://www.springframework.org/schema/integration/websocket"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns="http://www.springframework.org/schema/beans"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
			http://www.springframework.org/schema/beans/spring-beans.xsd
			http://www.springframework.org/schema/integration
			http://www.springframework.org/schema/integration/spring-integration.xsd
			http://www.springframework.org/schema/integration/websocket
			http://www.springframework.org/schema/integration/websocket/spring-integration-websocket.xsd">

	<bean id="serverWebSocketContainer" class="org.springframework.integration.websocket.ServerWebSocketContainer">
		<constructor-arg value="/ws"/>
	</bean>

	<websocket:inbound-channel-adapter id="defaultAdapter" container="serverWebSocketContainer"/>

	<bean id="webSocketClient" class="org.mockito.Mockito" factory-method="mock">
		<constructor-arg value="org.springframework.web.socket.client.WebSocketClient"/>
	</bean>

	<websocket:client-container id="clientWebSocketContainer"
								client="webSocketClient"
								uri="ws://foo.bar/{var}"
								uri-variables="ws"
								send-buffer-size-limit="1000"
								send-time-limit="100"
								origin="FOO"
								phase="100">
		<websocket:http-headers>
			<entry key="FOO" value="BAR,baz"/>
		</websocket:http-headers>
	</websocket:client-container>

	<bean id="stompSubProtocolHandler" class="org.springframework.web.socket.messaging.StompSubProtocolHandler"/>

	<bean id="passThruSubProtocolHandler"
		  class="org.springframework.integration.websocket.support.PassThruSubProtocolHandler"/>

	<bean id="simpleMessageConverter" class="org.springframework.integration.support.converter.SimpleMessageConverter"/>

	<bean id="mapMessageConverter" class="org.springframework.integration.support.converter.MapMessageConverter"/>

	<websocket:inbound-channel-adapter id="customAdapter" container="clientWebSocketContainer"
									   auto-startup="false"
									   payload-type="java.lang.Integer"
									   default-protocol-handler="stompSubProtocolHandler"
									   protocol-handlers="passThruSubProtocolHandler"
									   message-converters="simpleMessageConverter,mapMessageConverter"
									   merge-with-default-converters="true"
									   channel="clientInboundChannel"
									   error-channel="errorChannel"
									   send-timeout="2000"
									   phase="200"/>

	<int:channel id="clientInboundChannel"/>

</beans>
