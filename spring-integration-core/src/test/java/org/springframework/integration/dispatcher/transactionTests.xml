<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="https://www.springframework.org/schema/integration"
	xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance" xmlns:beans="https://www.springframework.org/schema/beans"
	xsi:schemaLocation="https://www.springframework.org/schema/beans
			https://www.springframework.org/schema/beans/spring-beans.xsd
			https://www.springframework.org/schema/integration
			https://www.springframework.org/schema/integration/spring-integration.xsd">

	<channel id="badInput">
		<queue capacity="1" />
	</channel>

	<channel id="goodInput">
		<queue capacity="1" />
	</channel>
	
	<channel id="goodInputWithAdvice">
		<queue capacity="1" />
	</channel>

	<channel id="output">
		<queue capacity="1" />
	</channel>

	<service-activator input-channel="badInput" ref="testBean"
		method="bad" output-channel="output">
		<poller max-messages-per-poll="1" fixed-rate="10000">
			<transactional transaction-manager="txManager" />
		</poller>
	</service-activator>

	<service-activator input-channel="goodInput" ref="testBean"
		method="good" output-channel="output">
		<poller max-messages-per-poll="1" fixed-rate="10000">
			<transactional transaction-manager="txManager" />
		</poller>
	</service-activator>
	
	<service-activator id="advicedSa" input-channel="goodInputWithAdvice" ref="testBean"
		method="good" output-channel="output">
		<poller max-messages-per-poll="1" fixed-rate="10000">
			<advice-chain>
				<ref bean="txAdvise"/>
				<ref bean="adviceA" />
				<beans:bean class="org.springframework.integration.dispatcher.PollingTransactionTests.SampleAdvice"/>
			</advice-chain>
		</poller>
	</service-activator>
	
	<beans:bean id="txAdvise" class="org.springframework.transaction.interceptor.TransactionInterceptor">
		<beans:property name="transactionManager" ref="txManager"/>
		<beans:property name="transactionAttributeSource">
			<beans:bean class="org.springframework.transaction.interceptor.MatchAlwaysTransactionAttributeSource">
				<beans:property name="transactionAttribute">
					<beans:bean class="org.springframework.transaction.interceptor.DefaultTransactionAttribute"/>
				</beans:property>
			</beans:bean>
		</beans:property>
	</beans:bean>
	
	<beans:bean id="adviceA" class="org.springframework.integration.dispatcher.PollingTransactionTests.SampleAdvice"/>

	<beans:bean id="testBean"
		class="org.springframework.integration.dispatcher.TestBean" />

	<beans:bean id="txManager"
		class="org.springframework.integration.util.TestTransactionManager" />
</beans:beans>
