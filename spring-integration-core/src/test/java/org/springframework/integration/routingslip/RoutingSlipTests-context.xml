<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/integration"
			 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			 xmlns:beans="http://www.springframework.org/schema/beans"
			 xmlns:task="http://www.springframework.org/schema/task"
			 xsi:schemaLocation="http://www.springframework.org/schema/beans
			http://www.springframework.org/schema/beans/spring-beans.xsd
			http://www.springframework.org/schema/integration
			http://www.springframework.org/schema/integration/spring-integration.xsd http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd">

	<message-history/>

	<task:executor id="executor"/>

	<beans:bean id="routingSlipRoutingPojo"
				class="org.springframework.integration.routingslip.RoutingSlipTests$TestRoutingSlipRoutePojo"/>

	<beans:bean id="routingSlipRoutingStrategy"
				class="org.springframework.integration.routingslip.RoutingSlipTests$TestRoutingSlipRouteStrategy"/>

	<header-enricher input-channel="input" output-channel="split">
		<routing-slip value="channel1; #{@routingSlipRoutingPojo.get(request, reply)}; @routingSlipRoutingStrategy;
				#{request.headers[myRoutingSlipChannel]}; aggregate"/>
	</header-enricher>

	<splitter input-channel="split" output-channel="process"/>

	<channel id="process">
		<dispatcher task-executor="executor"/>
	</channel>

	<bridge input-channel="process"/>

	<bridge input-channel="channel1"/>

	<bridge input-channel="channel2"/>

	<bridge input-channel="channel3"/>

	<bridge input-channel="channel4"/>

	<chain input-channel="channel5">
		<header-filter header-names="myRoutingSlipChannel"/>
	</chain>

	<aggregator input-channel="aggregate" expression="new java.util.ArrayList(#root)"/>

</beans:beans>
