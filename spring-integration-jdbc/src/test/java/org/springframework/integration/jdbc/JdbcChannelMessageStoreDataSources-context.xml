<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:jdbc="http://www.springframework.org/schema/jdbc"
	xsi:schemaLocation="http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd
			http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource" />
		<!-- <property name="defaultTimeout" value="2000" /> -->
		<!-- Postgres 9 does not support send timeouts. You may see an exception like:
		"java.sql.SQLFeatureNotSupportedException: Method org.postgresql.jdbc4.Jdbc4PreparedStatement.setQueryTimeout(int) is not yet implemented."
		-->
	</bean>

	<beans profile="default, hsql">

		<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
			<property name="driverClassName" value="org.hsqldb.jdbcDriver"/>
			<property name="initialSize" value="10"/>
			<property name="url" value="jdbc:hsqldb:mem:integration;hsqldb.tx=mvcc" />
			<property name="username" value="sa" />
			<property name="password" value="" />
		</bean>

		<jdbc:initialize-database data-source="dataSource" ignore-failures="DROPS">
			<jdbc:script execution="INIT" location="classpath:org/springframework/integration/jdbc/messagestore/channel/schema-drop-hsql.sql"/>
			<jdbc:script execution="INIT" location="classpath:org/springframework/integration/jdbc/messagestore/channel/schema-hsql.sql"/>
		</jdbc:initialize-database>

		<bean id="queryProvider" class="org.springframework.integration.jdbc.support.messagestore.channel.query.HsqlQueryProvider"/>
	</beans>

	<beans profile="derby">

		<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
			<property name="driverClassName" value="org.apache.derby.jdbc.EmbeddedDriver"/>
			<property name="initialSize" value="10"/>
			<property name="url" value="jdbc:derby:memory:integration;create=true" />
			<property name="username" value="int" />
			<property name="password" value="int" />
		</bean>

<!--  	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
			<property name="driverClassName" value="org.apache.derby.jdbc.ClientDriver"/>
			<property name="initialSize" value="10"/>
			<property name="url" value="jdbc:derby://localhost:1527/integration;create=true" />
			<property name="username" value="int" />
			<property name="password" value="int" />
		</bean> -->

		<jdbc:initialize-database data-source="dataSource">
			<jdbc:script location="classpath:org/springframework/integration/jdbc/messagestore/channel/schema-derby.sql" />
		</jdbc:initialize-database>

		<bean id="queryProvider" class="org.springframework.integration.jdbc.support.messagestore.channel.query.DerbyQueryProvider"/>
	</beans>

	<beans profile="mysql">
		<bean id="dataSource" destroy-method="close"
			class="org.apache.commons.dbcp.BasicDataSource">
			<property name="driverClassName" value="com.mysql.jdbc.Driver" />
			<property name="url" value="jdbc:mysql://localhost/test" />
			<property name="username" value="root" />
			<property name="password" value="" />
			<property name="initialSize" value="10" />
			<property name="defaultAutoCommit" value="false" />
		</bean>

		<bean id="queryProvider" class="org.springframework.integration.jdbc.support.messagestore.channel.query.MySqlQueryProvider"/>
	</beans>
	<beans profile="oracle">
		<bean id="dataSource" class="oracle.jdbc.pool.OracleDataSource" destroy-method="close">
			<property name="connectionCachingEnabled" value="true" />
			<property name="URL" value="jdbc:oracle:thin:@//10.0.1.6:1521/XE" />
			<property name="password" value="TT2" />
			<property name="user"     value="tt" />
			<property name="connectionCacheProperties">
				<props merge="default">
					 <prop key="MinLimit">3</prop>
					 <prop key="MaxLimit">20</prop>
				</props>
			 </property>
		</bean>

		<bean id="queryProvider" class="org.springframework.integration.jdbc.support.messagestore.channel.query.OracleQueryProvider"/>
	</beans>
	<beans profile="postgres">
		<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
			destroy-method="close">
			<property name="driverClassName" value="org.postgresql.Driver" />
			<property name="initialSize" value="10"/>
			<property name="url"
				value="jdbc:postgresql:integration" />
			<property name="username" value="postgres" />
			<property name="password" value="postgres" />
		</bean>

		<bean id="queryProvider" class="org.springframework.integration.jdbc.support.messagestore.channel.query.PostgresQueryProvider"/>
	</beans>

</beans>
